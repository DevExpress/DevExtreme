'use strict';

const stagedFiles = require('staged-git-files');
const validateMaxPath = require('./validate-max-path');
const validateWorkflows = require('./validate-workflows');
const validateCyrillic = require('./validate-cyrillic-symbols');

const fileStatuses = {
    Added: true,
    Copied: true,
    Deleted: false,
    Modified: true,
    Renamed: true,
    'Type-Change': false,
    Unmerged: false,
    Unknown: false
};

(async() => {
    await stagedFiles(async(err, results) => {
        let errors = 0;
        const staged = results.filter(x => fileStatuses[x.status]);

        errors = errors | validateMaxPath(staged);
        errors = errors | validateWorkflows(staged);
        errors = errors | await validateCyrillic(staged);

        if(errors) {
            throw Error('Pre-commit checks failed');
        }
    });
})();
