<!DOCTYPE html>
<html lang="en">

<head>
    <title>DevExtreme jQuery Example</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script type="text/javascript">
        const currentThemeId = localStorage.getItem("currentThemeId") || "light";

        const link = document.createElement("link");
        link.href = `../artifacts/css/dx.${currentThemeId}.css`;
        link.type = "text/css";
        link.rel = "stylesheet";

        document.getElementsByTagName("head")[0].appendChild(link);
    </script>

    <script type="text/javascript" src="../artifacts/js/jquery.js"></script>
    <!-- HtmlEditor -->
    <!-- <script type="text/javascript" src="../artifacts/js/dx-quill.min.js"></script> -->

    <!--<script type="text/javascript" src="../artifacts/js/cldr.js"></script>
    <script type="text/javascript" src="../artifacts/js/cldr/event.js"></script>
    <script type="text/javascript" src="../artifacts/js/cldr/supplemental.js"></script>
    <script type="text/javascript" src="../artifacts/js/cldr/unresolved.js"></script>
    <script type="text/javascript" src="../artifacts/js/globalize.js"></script>
    <script type="text/javascript" src="../artifacts/js/globalize/message.js"></script>
    <script type="text/javascript" src="../artifacts/js/globalize/number.js"></script>
    <script type="text/javascript" src="../artifacts/js/globalize/currency.js"></script>
    <script type="text/javascript" src="../artifacts/js/globalize/date.js"></script>-->

    <!--
    <script type="text/javascript" src="../artifacts/js/exceljs.min.js"></script>
    <script type="text/javascript" src="../artifacts/js/FileSaver.min.js"></script>
    <script type="text/javascript" src="../artifacts/js/jszip.min.js"></script>
    <script type="text/javascript" src="../artifacts/js/jspdf.umd.min.js"></script>
    <script type="text/javascript" src="../artifacts/js/jspdf.plugin.autotable.min.js"></script>
    -->

    <script type="text/javascript" src="../artifacts/js/dx.all.debug.js" charset="utf-8"></script>
    <script type="text/javascript" src="./themeSelector.js"></script>
    <script type="text/javascript" src="../../../node_modules/axe-core/axe.min.js"></script>
</head>

<body class="dx-surface">
    <div role="main">
        <h1 style="position: fixed; left: 0; top: 0; clip: rect(1px, 1px, 1px, 1px);">Test header</h1>

        <select id="theme-selector" style="display: block;">
        </select>
        <br />
        <div id="cardview"></div>
        <script>
            function isNotEmpty(value) {
                return value !== undefined && value !== null && value !== '';
            }
            const store = new DevExpress.data.CustomStore({
                key: 'OrderNumber',
                load(loadOptions) {
                    const deferred = $.Deferred();

                    const paramNames = [
                        'skip', 'take', 'requireTotalCount', 'requireGroupCount',
                        'sort', 'filter', 'totalSummary', 'group', 'groupSummary',
                    ];

                    const args = {};

                    paramNames
                        .filter((paramName) => isNotEmpty(loadOptions[paramName]))
                        .forEach((paramName) => { args[paramName] = JSON.stringify(loadOptions[paramName]); });

                    $.ajax({
                        url: 'https://js.devexpress.com/Demos/WidgetsGalleryDataService/api/orders',
                        dataType: 'json',
                        data: args,
                        success(result) {
                            deferred.resolve(result.data, {
                                totalCount: result.totalCount,
                                summary: result.summary,
                                groupCount: result.groupCount,
                            });
                        },
                        error() {
                            deferred.reject('Data Loading Error');
                        },
                        timeout: 5000,
                    });

                    return deferred.promise();
                },
            });

            $(function () {
                $("#cardview").dxCardView({
                    accessKey: 'q',
                    dataSource: store,
                    width: "70%",
                    height: 300,
                    keyExpr: 'OrderNumber',
                    fieldTemplate({ defaultTemplate, ...props}, index) {
                        const el = $('<div>')
                        if (index % 2) {
                            el.css({color: 'red'});
                        }
                        defaultTemplate.render(props, index, el);
                        return el;
                    },
                    columns: [
                        {
                            dataField: 'OrderNumber',
                            // alignment: 'right',
                            dataType: 'number',
                        },
                        {
                            dataField: 'OrderDate',
                            visible: false,
                        },
                        'StoreCity',
                        'StoreState',
                        'Employee',
                        'SaleAmount',
                    ],
                    filterPanelVisible: true,
                    onInitialized(e) {
                        window.cardView = e.component;
                    }
                });
            });
        </script>
    </div>
</body>

</html>