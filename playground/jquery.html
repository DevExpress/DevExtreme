<!DOCTYPE html>
<html>
<head>
    <title>DevExtreme jQuery Example</title>

    <link rel="stylesheet" type="text/css" href="../artifacts/css/dx.common.css"/>

    <link rel="stylesheet" type="text/css" href="../artifacts/css/dx.light.css"/>

    <script type="text/javascript" src="../artifacts/js/jquery.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.5/jszip.min.js"></script>    
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/1.6.3/exceljs.js"></script>
    <!--<script type="text/javascript" src="../artifacts/js/cldr.js"></script>
    <script type="text/javascript" src="../artifacts/js/cldr/event.js"></script>
    <script type="text/javascript" src="../artifacts/js/cldr/supplemental.js"></script>
    <script type="text/javascript" src="../artifacts/js/cldr/unresolved.js"></script>
    <script type="text/javascript" src="../artifacts/js/globalize.js"></script>
    <script type="text/javascript" src="../artifacts/js/globalize/currency.js"></script>
    <script type="text/javascript" src="../artifacts/js/globalize/date.js"></script>
    <script type="text/javascript" src="../artifacts/js/globalize/message.js"></script>
    <script type="text/javascript" src="../artifacts/js/globalize/number.js"></script>-->

    <script type="text/javascript" src="../artifacts/js/dx.all.debug.js"></script>
    <style>
        #gridContainer {
            height: 440px;
        }

        .oldOrder {
            color: #AAAAAA;
        }

        .highAmountOrder_saleAmount {
            background-color: #FFBB00;
            color: #000000;
        }

        .highAmountOrder_employee {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="dataGrid"></div>
    <hr/><br/>
    <div id="export"></div>
    <div id="export2"></div>
    <div id="export3"></div>
    <div id="export4"></div>
    <div id="export5"></div>
    <script>
        $(function() {
            $("#dataGrid").dxDataGrid({
                dataSource: employees,
                showBorders: true,
                showColumnHeaders: true,
                export: {
                    enabled: true,
                    fileName: "Employees",
                    excelFilterEnabled: true,
                    customizeExcelCell: options => {
                        if(options.gridCell.rowType === 'data') {
                            if(options.gridCell.data.SaleAmount > 15000) {
                                if(options.gridCell.column.dataField === 'Employee') {
                                    options.font.bold = true;
                                }
                                if(options.gridCell.column.dataField === 'SaleAmount') {
                                    options.backgroundColor = '#FFBB00';
                                    options.font.color = '#000000';
                                }
                            }
                        }
                    }
                },
                groupPanel: {
                    visible: true
                },
                columns: [
                    {
                        dataField: "Prefix",
                        caption: "Title",
                        width: 60
                    }, 
                    "FirstName",
                    "LastName", 
                    "City",
                    "State", 
                    {
                        dataField: "Position",
                        width: 130
                    }, {
                        dataField: "BirthDate",
                        dataType: "date",
                        width: 100
                    }, {
                        dataField: "HireDate",
                        dataType: "date",
                        width: 100
                    },
                    {
                        dataField: "SaleAmount",
                        alighment: "right",
                        format: "currency"    
                    }    
                ],
                onCellPrepared: e => {
                    if(e.rowType === 'data') {
                        if(e.data.SaleAmount > 15000) {
                            if(e.column.dataField === 'FirstName') {
                                e.cellElement.addClass('highAmountOrder_employee');
                            }
                            if(e.column.dataField === 'SaleAmount') {
                                e.cellElement.addClass('highAmountOrder_saleAmount');
                            }
                        }
                    }
                },
                onExporting: (e) => {
                    e.cancel = true;
                    // делаем наши действия

                    var ExcelJSWorkbook = new ExcelJS.Workbook();
                    var worksheet= ExcelJSWorkbook.addWorksheet('ExcelJS sheet');

                    worksheet.getCell("C1").value = "My header";

                    var position = DevExpress.clientExporter.excelExport.excelExport(e.component, worksheet, 
                    {startCell: "B2", customizeExcelCell: function (options, worksheet, cell){
                        cell.value = options.gridCell.value + "1";
                        cell.font = { bold: true };
                    }}); 
                    // worksheet.getCell(1, size.bottom + 1).value = "My Footer";
                    setTimeout(() => {
                        ExcelJSWorkbook.xlsx.writeBuffer()
                        .then(function(buffer) {
                            DevExpress.clientExporter.fileSaver.saveAs('DataGridExcelExport', "EXCEL", new Blob([buffer]));
                        });
                    }, 1000);
                    
                }
            });

            $("#export").dxButton({
                text: "export excelJS",
                type: "success",
                onClick: function(){
                    var DataGrid = $("#dataGrid").dxDataGrid("instance");

                    excelExport(DataGrid);
                }
            })

            $("#export2").dxButton({
                text: "export excelJS",
                type: "success",
                onClick: function(){
                    var DataGrid = $("#dataGrid").dxDataGrid("instance");
                    var ExcelJSWorkbook = new ExcelJS.Workbook();
                    var worksheet= ExcelJSWorkbook.addWorksheet('ExcelJS sheet');

                    worksheet.getCell("C1").value = "My header";

                    var size = excelExport(DataGrid, worksheet, 'B2');
                    worksheet.getCell(1, size.bottom + 1).value = "My Footer";
                }
            })

            $("#export3").dxButton({
                text: "export excelJS",
                onClick: function(){
                    
                    var DataGrid = $("#dataGrid").dxDataGrid("instance");
                    var ExcelJSWorkbook = new ExcelJS.Workbook();
                    var worksheet= ExcelJSWorkbook.addWorksheet('ExcelJS sheet');

                    worksheet.getCell("C1").value = "My header";

                    var size = DataGrid.option().export.excelExport(DataGrid, worksheet, {startCell: "B2", customizeExcelCell: function (options, worksheet, cell){
                        cell.value = options.gridCell.value + "1";
                        cell.font = { bold: true };
                    }});
                    worksheet.getCell(1, size.bottom + 1).value = "My Footer";
                }
            })

            $("#export4").dxButton({
                text: "export excelJS",
                onClick: function(){
                    var DataGrid = $("#dataGrid").dxDataGrid("instance");
                    var ExcelJSWorkbook = new ExcelJS.Workbook();
                    var worksheet= ExcelJSWorkbook.addWorksheet('ExcelJS sheet');

                    DataGrid.option("export.customizeHeader") = function(e) {
                        e.worksheet.getCell("C1").value = "My header";
                        e.startCell = "B3";
                    }

                    DataGrid.option("export.customizeFooter") = function(e) {
                        e.worksheet.getCell(1, worksheet.rowCount + 1).value = "My Footer";
                    }

                    DataGrid.option("export.customizeExcelCell") = function (options, worksheet, cell){
                        cell.value = options.gridcell.value + "1";
                        cell.font = { bold: true };
                    }

                    DataGrid.excelExport();
                }
            })

            $("#export5").dxButton({
                text: "export",
                onClick: function(){
                    var ExcelJSWorkbook = new ExcelJS.Workbook();
                    var worksheet= ExcelJSWorkbook.addWorksheet('ExcelJS sheet');

                    worksheet.getCell("C1").value = "My header";

                    var myHeaders = [{
                        value:"OrderID",
                        textAlign: "center",
                        background:"#60b5ff",
                        color:"#ffffff"
                    }];

                    $("#dataGrid").dxDataGrid("instance").excelExport(0, 0, { cells: myHeaders, type: "header", height: 70});
                }
            })

            

            // var excelExport = function(DataGrid){
            //     var ExcelJSWorkbook = new ExcelJS.Workbook();
            //     var worksheet= ExcelJSWorkbook.addWorksheet('ExcelJS sheet');
            //     var columns = DataGrid.getVisibleColumns();
            //     var headerRow = worksheet.addRow();
            //     worksheet.getRow(4).font = { bold: true };

            //     for(i = 0; i < columns.length; i++) {
            //         let currentColumnWidth = DataGrid.option().columns[i].width;
            //         worksheet.getColumn(i+1).width = currentColumnWidth !== undefined ? currentColumnWidth / 6 : 20;
            //         cell = headerRow.getCell(i + 1);
            //         cell.value = columns[i].caption;
            //     }

            //     if (DataGrid.option().export.excelFilterEnabled === true) {
            //         var headerRow 
            //         worksheet.autoFilter = {
            //             from: {
            //                 row: 3,
            //                 column: 1
            //             },
            //             to: {
            //                 row: 3,
            //                 column: columns.length
            //             }
            //         }
            //     }

            //     DataGrid.option().export.excelFilterEnabled === true ? worksheet.views = [{state: 'frozen', ySplit: 3}] : undefined;


            //     worksheet.properties.outlineProperties = {
            //         summaryBelow: false,
            //         summaryRight: false,
            //     };
                                    
            //     DataGrid.getController("data").loadAll().
            //     then(
            //         function(allItems) {
                        
            //             for(i = 0; i < allItems.length; i++) {
            //                 var dataRow = worksheet.addRow();
            //                 if (allItems[i].rowType === "data") {dataRow.outlineLevel = 1;}
            //                 for(j = 0; j < allItems[i].values.length; j++) {
            //                     cell = dataRow.getCell(j + 1);
            //                     cell.value = allItems[i].values[j];
            //                 }
            //             }

            //             const rowCount = worksheet.rowCount;
            //             worksheet.mergeCells(`A${rowCount}:I${rowCount+1}`);
            //             worksheet.getRow(1).font = { bold: true };
            //             worksheet.getCell(`A${rowCount}`).font = {
            //                 name: 'Comic Sans MS',
            //                 family: 4,
            //                 size: 20,
            //                 underline: true,
            //                 bold: true
            //             };
            //             worksheet.getCell(`A${rowCount}`).alighment = { vertical: 'middle', horizontal: 'center' };
            //             worksheet.getCell(`A${rowCount}`).value = "Custom Footer here"

            //             ExcelJSWorkbook.xlsx.writeBuffer()
            //                 .then(function(buffer) {
            //                     saveAs(new Blob([buffer], { type: 'application/octet-stream' }), `${DataGrid.option().export.fileName}.xlsx`);
            //                 }
            //             )
            //         }
            //     )

                    
            // }            
        });
    </script>
    <script>
    var employees = [{
    "ID": 1,
    "FirstName": "John",
    "LastName": "Heart",
    "Prefix": "Mr.",
    "Position": "CEO",
    "Picture": "images/employees/01.png",
    "BirthDate": "1964/03/16",
    "HireDate": "1995/01/15",
    "Notes": "John has been in the Audio/Video industry since 1990. He has led DevAv as its CEO since 2003.\r\n\r\nWhen not working hard as the CEO, John loves to golf and bowl. He once bowled a perfect game of 300.",
    "Address": "351 S Hill St.",
    "State": "California",
    "City": "Los Angeles",
    "SaleAmount" : 11800,
}, {
    "ID": 2,
    "FirstName": "Olivia",
    "LastName": "Peyton",
    "Prefix": "Mrs.",
    "Position": "Sales Assistant",
    "Picture": "images/employees/09.png",
    "BirthDate": "1981/06/03",
    "HireDate": "2012/05/14",
    "Notes": "Olivia loves to sell. She has been selling DevAV products since 2012. \r\n\r\nOlivia was homecoming queen in high school. She is expecting her first child in 6 months. Good Luck Olivia.",
    "Address": "807 W Paseo Del Mar",
    "State": "California",
    "City": "Los Angeles",
    "SaleAmount" : 16050,
}, {
    "ID": 3,
    "FirstName": "Robert",
    "LastName": "Reagan",
    "Prefix": "Mr.",
    "Position": "CMO",
    "Picture": "images/employees/03.png",
    "BirthDate": "1974/09/07",
    "HireDate": "2002/11/08",
    "Notes": "Robert was recently voted the CMO of the year by CMO Magazine. He is a proud member of the DevAV Management Team.\r\n\r\nRobert is a championship BBQ chef, so when you get the chance ask him for his secret recipe.",
    "Address": "4 Westmoreland Pl.",
    "State": "Arkansas",
    "City": "Bentonville",
    "SaleAmount" : 14750,    
}, {
    "ID": 4,
    "FirstName": "Greta",
    "LastName": "Sims",
    "Prefix": "Ms.",
    "Position": "HR Manager",
    "Picture": "images/employees/04.png",
    "BirthDate": "1977/11/22",
    "HireDate": "1998/04/23",
    "Notes": "Greta has been DevAV's HR Manager since 2003. She joined DevAV from Sonee Corp.\r\n\r\nGreta is currently training for the NYC marathon. Her best marathon time is 4 hours. Go Greta.",
    "Address": "1700 S Grandview Dr.",
    "State": "Georgia",
    "City": "Atlanta",
    "SaleAmount" : 14800,
}, {
    "ID": 5,
    "FirstName": "Brett",
    "LastName": "Wade",
    "Prefix": "Mr.",
    "Position": "IT Manager",
    "Picture": "images/employees/05.png",
    "BirthDate": "1968/12/01",
    "HireDate": "2009/03/06",
    "Notes": "Brett came to DevAv from Microsoft and has led our IT department since 2012.\r\n\r\nWhen he is not working hard for DevAV, he coaches Little League (he was a high school pitcher).",
    "Address": "1120 Old Mill Rd.",
    "State": "Idaho",
    "City": "Boise",
    "SaleAmount" : 8200,
}, {
    "ID": 6,
    "FirstName": "Sandra",
    "LastName": "Johnson",
    "Prefix": "Mrs.",
    "Position": "Controller",
    "Picture": "images/employees/06.png",
    "BirthDate": "1974/11/15",
    "HireDate": "2005/05/11",
    "Notes": "Sandra is a CPA and has been our controller since 2008. She loves to interact with staff so if you've not met her, be certain to say hi.\r\n\r\nSandra has 2 daughters both of whom are accomplished gymnasts.",
    "Address": "4600 N Virginia Rd.",
    "State": "Utah",
    "City": "Beaver",
    "SaleAmount" : 20400,
}, {
    "ID": 7,
    "FirstName": "Kevin",
    "LastName": "Carter",
    "Prefix": "Mr.",
    "Position": "Shipping Manager",
    "Picture": "images/employees/07.png",
    "BirthDate": "1978/01/09",
    "HireDate": "2009/08/11",
    "Notes": "Kevin is our hard-working shipping manager and has been helping that department work like clockwork for 18 months.\r\n\r\nWhen not in the office, he is usually on the basketball court playing pick-up games.",
    "Address": "424 N Main St.",
    "State": "California",
    "City": "San Diego",
    "SaleAmount" : 15850,
}, {
    "ID": 8,
    "FirstName": "Cynthia",
    "LastName": "Stanwick",
    "Prefix": "Ms.",
    "Position": "HR Assistant",
    "Picture": "images/employees/08.png",
    "BirthDate": "1985/06/05",
    "HireDate": "2008/03/24",
    "Notes": "Cindy joined us in 2008 and has been in the HR department for 2 years. \r\n\r\nShe was recently awarded employee of the month. Way to go Cindy!",
    "Address": "2211 Bonita Dr.",
    "State": "Arkansas",
    "City": "Little Rock",
    "SaleAmount" : 13500,
}, {
    "ID": 9,
    "FirstName": "Kent",
    "LastName": "Samuelson",
    "Prefix": "Dr.",
    "Position": "Ombudsman",
    "Picture": "images/employees/02.png",
    "BirthDate": "1972/09/11",
    "HireDate": "2009/04/22",
    "Notes": "As our ombudsman, Kent is on the front-lines solving customer problems and helping our partners address issues out in the field.    He is a classically trained musician and is a member of the Chamber Orchestra.",
    "Address": "12100 Mora Dr",
    "State": "Missouri",
    "City": "St. Louis",
    "SaleAmount" : 23500,
}, {
    "ID": 10,
    "FirstName": "Taylor",
    "LastName": "Riley",
    "Prefix": "Mr.",
    "Position": "Network Admin",
    "Picture": "",
    "BirthDate": "1982/08/14",
    "HireDate": "2012/04/14",
    "Notes": "If you are like the rest of us at DevAV, then you've probably reached out for help from Taylor. He does a great job as a member of our IT department.",
    "Address": "7776 Torreyson Dr",
    "State": "California",
    "City": "San Jose",
    "SaleAmount" : 13200,
}];
    </script>
    </script>
  </body>
</html>
